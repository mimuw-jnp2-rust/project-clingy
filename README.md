# clingy

## Authors
- Przemysław Kusiak (group 9)

## Description
Clingy is a simple linker that takes the ELF object files and creates ELF
executable.

## Changelog

#### 26.06.2022
 * More detailed and robust error handling. CLI in `clap`.
 * Most TODOs fixed.
 * Bugfixing.

#### 20.06.2022
 * `NOBITS` (`.bss`) support
 * Refactoring so that the code looks nicer and is more idiomatic.

#### 17.06.2022
 * Added `vec_map` crate and introduced `newtype` pattern to ensure type safety.

#### 09.06.2022
 * 1.4k SLOC reached.
 * Minimal working example: linking simple object files without shared
   dependencies, generated by NASM and GCC, into a static executable. Files are
   processed in parallel wherever possible.

#### 03.06.2022
 * 1k SLOC reached. Still not enough to show minimal working example.

## Demonstration

```
> cd examples
> nasm -w+all -f elf64 -o data_and_exit.o data_and_exit.asm
> nasm -w+all -f elf64 -o hello_world.o hello_world.asm
> ../target/debug/project-clingy hello_world.o data_and_exit.o -o output

[1/5] preprocessing files
[2/5] fixing layout
[3/5] gathering all symbols
[4/5] relocating
relocation:
    0x401010 (u64, absolute) inserted at:
    0x40000c (in output file: 0x100c)
relocation:
    0x401000 (i32, sign-extended absolute) inserted at:
    0x400017 (in output file: 0x1017)
relocation:
    0xe (i32, PC relative) inserted at:
    0x40001e (in output file: 0x101e)
[5/5] outputing

> ./output
Hello, cruel world!⏎
```

#### Longer example with `GCC`

```
> cd examples
> nasm -w+all -f elf64 -o with_bss.o with_bss.asm
> gcc -c -Wall -Wextra -nostdlib -fno-stack-protector helper.c -o helper.o
> for i in ".comment" ".note.gnu.property" ".note.GNU-stack" ".rela.eh_frame" ".eh_frame" 
  do
      objcopy --remove-section $i helper.o
  done
> ../target/debug/project-clingy with_bss.o helper.o -o output2

[1/5] preprocessing files
[2/5] fixing layout
[3/5] gathering all symbols
[4/5] relocating
... 12 relocations, logs ommited for brevity
[5/5] outputing

> ./output2
2137⏎
```

## Roadmap

#### What I was not able to implement by the end of the semester.
 * Alignment (the remaining `TODO`s).
 * Merging .symtabs from different files into one .symtab. (Binaries generated
   by clingy are stripped right now: we are not outputing .symtab. That has to
   be changed).
 * Tests.

For some of those things I'm still not sure how to do it right - it requires
some digging on my part and recently I'm running out of time.

#### Future (hopefully;))
 * Support for static library archives (.a) and libc. Ability to link standalone
   C programs.
 * Generating .GOT and .PLT, linking with shared libraries, PIE support.
 * Slowly moving to a feature-complete linker: support for things like handling
   COMDAT sections for example.
 * Feature-complete linker: ability to link Chromium. Full-fledged support for
   linking scripts. More architectures. Simple LTOs like Mark&Sweep from entry
   symbol to remove unused sections.
